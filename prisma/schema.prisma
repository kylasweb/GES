generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String          @id @default(cuid())
  email     String          @unique
  name      String?
  password  String
  phone     String?
  role      UserRole        @default(CUSTOMER)
  isActive  Boolean         @default(true)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  addresses Address[]
  orders    Order[]
  reviews   ProductReview[]

  @@map("users")
}

model Address {
  id          String      @id @default(cuid())
  userId      String
  type        AddressType
  name        String
  phone       String
  addressLine String
  city        String
  state       String
  postalCode  String
  country     String      @default("India")
  isDefault   Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("addresses")
}

model Category {
  id          String    @id @default(cuid())
  name        String    @unique
  slug        String    @unique
  description String?
  image       String?
  isActive    Boolean   @default(true)
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]

  @@map("categories")
}

model Brand {
  id          String    @id @default(cuid())
  name        String    @unique
  slug        String    @unique
  description String?
  logo        String?
  website     String?
  isActive    Boolean   @default(true)
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]

  @@map("brands")
}

model ProductTag {
  id        String    @id @default(cuid())
  name      String    @unique
  slug      String    @unique
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]

  @@map("product_tags")
}

model ProductAttribute {
  id           String                  @id @default(cuid())
  name         String
  slug         String                  @unique
  type         AttributeType           @default(TEXT)
  isVisible    Boolean                 @default(true)
  isFilterable Boolean                 @default(false)
  sortOrder    Int                     @default(0)
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
  values       ProductAttributeValue[]
  products     Product[]

  @@map("product_attributes")
}

model ProductAttributeValue {
  id          String             @id @default(cuid())
  attributeId String
  value       String
  slug        String
  sortOrder   Int                @default(0)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  attribute   ProductAttribute   @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  variations  ProductVariation[]

  @@unique([attributeId, value])
  @@map("product_attribute_values")
}

model Product {
  id             String             @id @default(cuid())
  name           String
  slug           String             @unique
  description    String
  shortDesc      String?
  sku            String             @unique
  price          Decimal            @db.Decimal(10, 2)
  comparePrice   Decimal?           @db.Decimal(10, 2)
  costPrice      Decimal?           @db.Decimal(10, 2)
  trackQuantity  Boolean            @default(true)
  quantity       Int                @default(0)
  weight         Decimal?           @db.Decimal(8, 3)
  dimensions     Json?
  images         Json
  videos         Json?
  tags           Json?
  customFields   Json? // Custom product fields (flexible key-value pairs)
  specifications Json? // Product specifications/technical details
  type           ProductType        @default(SIMPLE)
  isActive       Boolean            @default(true)
  featured       Boolean            @default(false)
  seoTitle       String?
  seoDesc        String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  categoryId     String
  brandId        String?
  orderItems     OrderItem[]
  inventory      ProductInventory?
  reviews        ProductReview[]
  variations     ProductVariation[]
  attributes     ProductAttribute[]
  productTags    ProductTag[]
  category       Category           @relation(fields: [categoryId], references: [id])
  brand          Brand?             @relation(fields: [brandId], references: [id])

  @@map("products")
}

model ProductVariation {
  id              String                  @id @default(cuid())
  productId       String
  sku             String?                 @unique
  price           Decimal?                @db.Decimal(10, 2)
  comparePrice    Decimal?                @db.Decimal(10, 2)
  costPrice       Decimal?                @db.Decimal(10, 2)
  quantity        Int                     @default(0)
  weight          Decimal?                @db.Decimal(8, 3)
  dimensions      Json?
  image           String?
  isActive        Boolean                 @default(true)
  sortOrder       Int                     @default(0)
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  product         Product                 @relation(fields: [productId], references: [id], onDelete: Cascade)
  attributeValues ProductAttributeValue[]
  orderItems      OrderItem[]

  @@map("product_variations")
}

model ProductInventory {
  id                String    @id @default(cuid())
  productId         String    @unique
  quantity          Int       @default(0)
  reserved          Int       @default(0)
  lowStockThreshold Int       @default(10)
  reorderPoint      Int       @default(5)
  lastRestocked     DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  product           Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_inventory")
}

model ProductReview {
  id         String   @id @default(cuid())
  productId  String
  userId     String
  rating     Int
  title      String?
  content    String
  isVerified Boolean  @default(false)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([productId, userId])
  @@map("product_reviews")
}

model Order {
  id              String        @id @default(cuid())
  orderNumber     String        @unique
  userId          String?
  status          OrderStatus   @default(PENDING)
  paymentStatus   PaymentStatus @default(PENDING)
  paymentMethod   PaymentMethod
  currency        String        @default("INR")
  subtotal        Decimal       @db.Decimal(10, 2)
  taxAmount       Decimal       @default(0) @db.Decimal(10, 2)
  shippingAmount  Decimal       @default(0) @db.Decimal(10, 2)
  discountAmount  Decimal       @default(0) @db.Decimal(10, 2)
  totalAmount     Decimal       @db.Decimal(10, 2)
  notes           String?
  shippingAddress Json?
  billingAddress  Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  documents       Document[]
  items           OrderItem[]
  user            User?         @relation(fields: [userId], references: [id])
  transactions    Transaction[]

  @@map("orders")
}

model OrderItem {
  id                 String            @id @default(cuid())
  orderId            String
  productId          String
  productName        String
  productSku         String
  quantity           Int
  unitPrice          Decimal           @db.Decimal(10, 2)
  totalPrice         Decimal           @db.Decimal(10, 2)
  createdAt          DateTime          @default(now())
  order              Order             @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product            Product           @relation(fields: [productId], references: [id])
  ProductVariation   ProductVariation? @relation(fields: [productVariationId], references: [id])
  productVariationId String?

  @@map("order_items")
}

model Transaction {
  id                   String         @id @default(cuid())
  orderId              String
  gateway              PaymentGateway
  gatewayTransactionId String?        @unique
  gatewayStatus        String?
  amount               Decimal        @db.Decimal(10, 2)
  currency             String         @default("INR")
  paymentMethod        PaymentMethod
  metadata             Json?
  webhookReceived      Boolean        @default(false)
  webhookData          Json?
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  gatewayResponse      Json?
  provider             String         @default("PHONEPE")
  status               String         @default("PENDING")
  transactionId        String         @unique
  refunds              Refund[]
  order                Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model Refund {
  id            String      @id @default(cuid())
  refundId      String      @unique
  transactionId String
  amount        Decimal     @db.Decimal(10, 2)
  reason        String
  status        String      @default("PENDING")
  refundData    Json?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  transaction   Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@map("refunds")
}

model Document {
  id        String       @id @default(cuid())
  orderId   String
  type      DocumentType
  name      String
  fileUrl   String
  fileSize  Int
  mimeType  String
  metadata  Json?
  createdAt DateTime     @default(now())
  order     Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("documents")
}

model ContentBlock {
  id        String      @id @default(cuid())
  type      ContentType
  title     String?
  content   Json
  order     Int         @default(0)
  isActive  Boolean     @default(true)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@map("content_blocks")
}

model Testimonial {
  id        String   @id @default(cuid())
  name      String
  role      String?
  company   String?
  content   String
  rating    Int
  image     String?
  isActive  Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("testimonials")
}

model Setting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  description String?
  updatedAt   DateTime @updatedAt

  @@map("settings")
}

model SalesLedger {
  id            String        @id @default(cuid())
  orderId       String        @unique
  orderNumber   String
  date          DateTime      @default(now())
  description   String
  debitAmount   Decimal       @default(0) @db.Decimal(10, 2)
  creditAmount  Decimal       @default(0) @db.Decimal(10, 2)
  balance       Decimal       @db.Decimal(10, 2)
  category      String
  paymentMethod PaymentMethod
  createdAt     DateTime      @default(now())

  @@map("sales_ledger")
}

model Currency {
  id        String   @id @default(cuid())
  code      String   @unique
  name      String
  symbol    String
  rate      Decimal  @db.Decimal(10, 6)
  isDefault Boolean  @default(false)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("currencies")
}

model Coupon {
  id            String     @id @default(cuid())
  code          String     @unique
  description   String?
  type          CouponType @default(PERCENTAGE)
  value         Decimal    @db.Decimal(10, 2)
  minOrderValue Decimal?   @db.Decimal(10, 2)
  maxDiscount   Decimal?   @db.Decimal(10, 2)
  usageLimit    Int?
  usageCount    Int        @default(0)
  perUserLimit  Int?
  validFrom     DateTime
  validUntil    DateTime
  isActive      Boolean    @default(true)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  @@map("coupons")
}

model Deal {
  id          String   @id @default(cuid())
  productId   String
  title       String
  description String?
  discount    Decimal  @db.Decimal(5, 2)
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("deals")
}

model Newsletter {
  id        String           @id @default(cuid())
  email     String           @unique
  name      String?
  status    SubscriberStatus @default(ACTIVE)
  source    String?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  @@map("newsletters")
}

model Wallet {
  id           String              @id @default(cuid())
  userId       String              @unique
  balance      Decimal             @default(0) @db.Decimal(10, 2)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  transactions WalletTransaction[]

  @@map("wallets")
}

model WalletTransaction {
  id          String                @id @default(cuid())
  walletId    String
  type        WalletTransactionType
  amount      Decimal               @db.Decimal(10, 2)
  balance     Decimal               @db.Decimal(10, 2)
  description String
  reference   String?
  createdAt   DateTime              @default(now())
  wallet      Wallet                @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@map("wallet_transactions")
}

model LoyaltyPoint {
  id             String   @id @default(cuid())
  userId         String   @unique
  points         Int      @default(0)
  lifetimePoints Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("loyalty_points")
}

model ShippingMethod {
  id          String       @id @default(cuid())
  name        String
  description String?
  type        ShippingType @default(FLAT_RATE)
  cost        Decimal      @db.Decimal(10, 2)
  minOrder    Decimal?     @db.Decimal(10, 2)
  maxOrder    Decimal?     @db.Decimal(10, 2)
  cities      Json?
  isActive    Boolean      @default(true)
  sortOrder   Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@map("shipping_methods")
}

model BlogPost {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  excerpt     String?
  content     String
  image       String?
  authorId    String?
  categoryId  String?
  tags        Json?
  seoTitle    String?
  seoDesc     String?
  isPublished Boolean   @default(false)
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("blog_posts")
}

model SupportTicket {
  id           String         @id @default(cuid())
  userId       String?
  ticketNumber String         @unique
  subject      String
  description  String
  status       TicketStatus   @default(OPEN)
  priority     TicketPriority @default(MEDIUM)
  category     String?
  email        String
  name         String
  responses    Json?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  @@map("support_tickets")
}

enum UserRole {
  CUSTOMER
  CONTENT_MANAGER
  ORDER_MANAGER
  FINANCE_MANAGER
  SUPER_ADMIN
}

enum AddressType {
  SHIPPING
  BILLING
}

enum OrderStatus {
  PENDING
  AWAITING_PAYMENT
  COD_PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum PaymentMethod {
  PHONEPE
  COD
  UPI
  CREDIT_CARD
  DEBIT_CARD
  NET_BANKING
}

enum PaymentGateway {
  PHONEPE
  RAZORPAY
  STRIPE
  PAYPAL
  MANUAL
}

enum DocumentType {
  INVOICE
  SHIPPING_LABEL
  PACKING_SLIP
  RECEIPT
  REFUND_NOTE
}

enum ContentType {
  HERO_BANNER
  FEATURED_PRODUCTS
  TESTIMONIALS
  CATEGORIES
  INFO_SECTION
  PROMOTION_BANNER
}

enum AttributeType {
  TEXT
  COLOR
  IMAGE
  SELECT
}

enum ProductType {
  SIMPLE
  VARIABLE
  GROUPED
  EXTERNAL
  DIGITAL
  CLASSIFIED
}

enum CouponType {
  PERCENTAGE
  FIXED
}

enum SubscriberStatus {
  ACTIVE
  UNSUBSCRIBED
}

enum WalletTransactionType {
  CREDIT
  DEBIT
  REFUND
}

enum ShippingType {
  FLAT_RATE
  PRODUCT_WISE
  CITY_WISE
  FREE
  PICKUP_POINT
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  AWAITING_CUSTOMER
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum MediaType {
  IMAGE
  VIDEO
  DOCUMENT
  OTHER
}

model Media {
  id           String    @id @default(cuid())
  filename     String
  originalName String
  mimeType     String
  size         Int
  width        Int?
  height       Int?
  url          String
  thumbnailUrl String?
  alt          String?
  caption      String?
  type         MediaType @default(IMAGE)
  folder       String?
  tags         String[]
  uploadedBy   String?
  usageCount   Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([type])
  @@index([folder])
  @@index([createdAt])
  @@map("media")
}

model LandingTemplate {
  id           String        @id @default(cuid())
  name         String
  slug         String        @unique
  description  String?
  thumbnail    String?
  isActive     Boolean       @default(false)
  config       Json?
  features     String[]
  colorScheme  String        @default("light")
  tags         String[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  siteSettings SiteSettings?

  @@map("landing_templates")
}

model SiteSettings {
  id               String           @id @default(cuid())
  siteName         String           @default("Green Energy Solutions")
  siteDescription  String?
  contactEmail     String?
  contactPhone     String?
  activeTemplateId String?          @unique
  activeTemplate   LandingTemplate? @relation(fields: [activeTemplateId], references: [id])
  maintenanceMode  Boolean          @default(false)
  headerStyle      String           @default("default") // default, minimal, centered, transparent, mega
  footerStyle      String           @default("default") // default, minimal, newsletter, social
  menuStyle        String           @default("default") // default, dropdown, mega, sidebar
  config           Json?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@map("site_settings")
}

model FeatureFlag {
  id          String   @id @default(cuid())
  key         String   @unique
  name        String
  description String?
  enabled     Boolean  @default(false)
  rollout     Int      @default(100) // Percentage rollout (0-100)
  config      Json?
  category    String? // e.g., "ai", "templates", "payments", "admin"
  createdBy   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([enabled])
  @@map("feature_flags")
}

model GitVersion {
  id            String   @id @default(cuid())
  version       String   @unique // e.g., "v1.2.3"
  commitHash    String   @unique
  commitMessage String?
  branch        String   @default("main")
  author        String?
  deployedBy    String?
  deployedAt    DateTime @default(now())
  isActive      Boolean  @default(false)
  changelog     String[]
  environment   String   @default("production") // production, staging, development
  buildNumber   Int      @default(autoincrement())
  rollbackable  Boolean  @default(true)
  metadata      Json?

  @@index([deployedAt])
  @@index([isActive])
  @@index([environment])
  @@map("git_versions")
}
